version: 2.1
jobs:
  build:
    docker: 
      #- image: circleci/node:4.8.2 # the primary container, where your job's commands are run
      - image: innovanon/poobuntu:latest
    #parallelism: 2
    steps:
      - checkout # check out the code in the project directory
      - run:
          name:    Update
          #command: sudo apt update
          command: apt update
      - run:
          name:    Upgrade
          #command: sudo apt full-upgrade -qy
          command: apt full-upgrade -qy
      - run:
          name:    Installing Binary Calculator and Parallel Gzip
          #command: sudo apt install -qy bc pigz
          command: apt install -qy bc pigz
      - run:
          #name:    Increasing Resource Limits for ImageMagick
          #command: sudo sed -i 's#^\( *<policy domain="resource" name="\(disk\|memory\)" value="\).*\("/>\)$#\110GiB\3#' /etc/ImageMagick-6/policy.xml
          name:    Increasing Disk Cache Limit for ImageMagick
          #command: sudo sed -i 's#^\( *<policy domain="resource" name="disk" value="\).*\("/>\)$#\110GiB\1#' /etc/ImageMagick-6/policy.xml
          command: sed -i 's#^\( *<policy domain="resource" name="disk" value="\).*\("/>\)$#\110GiB\1#' /etc/ImageMagick-6/policy.xml
      - run:
          name:    Increasing Memory Limit for ImageMagick
          #command: sudo sed -i 's#^\( *<policy domain="resource" name="memory" value="\).*\("/>\)$#\11GiB\1#' /etc/ImageMagick-6/policy.xml
          command: sed -i 's#^\( *<policy domain="resource" name="memory" value="\).*\("/>\)$#\11GiB\1#' /etc/ImageMagick-6/policy.xml
      - run:
          name:    Making the Project
          #command: make -j`nproc`
          command: make -j2
      - run:
          name:    Cleanup
          #command: make -j`nproc` clean
          command: make -j2 clean
      - store_artifacts:
          path: logo.png
      - store_artifacts:
          path: logo-visible.png
      - store_artifacts:
          path: logo-midvisible.png
      - store_artifacts:
          path: logo-animated.gif
      - store_artifacts:
          path: logo-small-animated.gif
      - store_artifacts:
          path: apple-touch-icon-120x120.png
      - store_artifacts:
          path: apple-touch-icon-152x152.png
      - store_artifacts:
          path: apple-touch-icon-60x60.png
      - store_artifacts:
          path: apple-touch-icon-76x76.png
      - store_artifacts:
          path: syslinux-splash.bmp
      - store_artifacts:
          path: grub-splash.xpm.gz
      - store_artifacts:
          path: favicon.ico
      - store_artifacts:
          path: github.png
      - store_artifacts:
          path: twitter-banner.png
      - store_artifacts:
          path: linkedin-banner.png
      - store_artifacts:
          path: youtube-banner.png
      - store_artifacts:
          path: soundcloud-banner.png

